<!doctype html>
<html lang=en>

<head>
    <meta charset=utf-8>
    <title>Cube Player</title>
    <meta name=author content="Chris Mitchell">
    <style>
        canvas {
            border: 2px solid blue;
        }
    </style>
    <script src="point.js"></script>
    <script src="vector.js"></script>
    <script src="shapes.js"></script>
    <script>
        'use strict';
        var canvas;
        var ctx;


        /** Backface culling check to see if the face is visible 
         * face -- list of point indices for the given face. Must be given in
         *     clockwise order.
         */
        function isFaceVisible(face, points) {
            var pt0 = points[face[0]];
            var pt1 = points[face[1]];
            var pt2 = points[face[2]];
            var vecA = new Vector(pt1.x - pt0.x,
                                  pt1.y - pt0.y,
                                  pt1.z - pt0.z);
            var vecB = new Vector(pt2.x - pt0.x,
                                  pt2.y - pt0.y,
                                  pt2.z - pt0.z);
            var camVec = new Vector(0, 0, -4);

            var normal = vecA.cross(vecB);
            var dotProd = normal.dot(camVec);
            return (dotProd > 0);
        }

        function drawCube(rotX, rotY, rotZ) {
            ctx.clearRect(-0.5, -0.5, 1, 1);
            var projected = [];
            for (var i = 0; i < points.length; i++) {
                var point = points[i].rotateX(rotX).rotateY(rotY).rotateZ(rotZ).project(4, Math.PI/4);
                projected.push(point);
            }
            for (var faceIdx = 0; faceIdx < faces.length; faceIdx++) {
                if (isFaceVisible(faces[faceIdx], projected) == false) {
                    continue;
                }
                ctx.beginPath();
                for (i = 0; i < faces[faceIdx].length; i++) {
                    point = projected[faces[faceIdx][i]];
                    ctx.lineTo(point.x, point.y);
                }
                ctx.fillStyle = colors[faceIdx];
                ctx.fill();
            }
        }

        function setup() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');

            ctx.translate(canvas.width/2, canvas.height/2); // put origin in center of canvas
            var scale = Math.min(canvas.width, canvas.height);
            ctx.scale(scale, scale); // normalize the shortest canvas-dimension to 1 unit
            ctx.lineWidth = 1/scale; // make lineWidth one pixel again

            var angle = 0;
            setInterval(function() {
                drawCube(angle, angle, angle);
                angle += 0.025;
            }, 20);
        }

        window.onload = setup;
    </script>
</head>

<body>
    <h1>Cube Player</h1>
    <canvas id=canvas width=500 height=500></canvas>
</body>

</html>
