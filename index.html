<!doctype html>
<html lang=en>

<head>
    <meta charset=utf-8>
    <title>Cube Player</title>
    <meta name=author content="Chris Mitchell">
    <style>
        body {
            background-color: #BBB;
        }
        canvas {
            background-color: #888;
        }
    </style>
    <script src="utils.js"></script>
    <script src="Point.js"></script>
    <script src="Vector.js"></script>
    <script src="Cube.js"></script>
    <script src="render.js"></script>
    <script>
        'use strict';

        // data used to manage the click-to-tumble feature
        var tumbleInfo = {
            dragging: false,
            // the start of the drag
            clickX: null,
            clickY: null,
            // the pre-drag tumble orientation
            startX: null,
            startY: null
        };

        var x = 0; var y = 0; var z = 0;

        var moves = parseMoves("F L F U' R U F2 L2 U' L' B D' B' L2 U");
        cube = moves.reduce(move, cube);

        function onMouseMove(e) {
            if (tumbleInfo.dragging) {
                y = tumbleInfo.startY + 0.01 * (tumbleInfo.clickX - e.screenX);
                x = tumbleInfo.startX + 0.01 * (tumbleInfo.clickY - e.screenY);
            }
        }

        function onMouseDown(e) {
            tumbleInfo.dragging = true;
            tumbleInfo.clickX = e.screenX;
            tumbleInfo.clickY = e.screenY;
            tumbleInfo.startX = x;
            tumbleInfo.startY = y;
            animate();
        }

        function onMouseUp(e) {
            tumbleInfo.dragging = false;
        }

        function animate() {
            drawShape(cube.tumble(x, y, z));
            if (tumbleInfo.dragging) {
                setTimeout(animate, 20);
            }
        }

        function setup() {
            var canvas = document.getElementById('canvas');
            canvas.addEventListener("mousedown", onMouseDown, false);
            window.addEventListener("mouseup", onMouseUp, false);
            window.addEventListener("mousemove", onMouseMove, false);

            initializeCanvas(canvas);

            animate();
        }

        window.onload = setup;
    </script>
</head>

<body>
    <h1>Cube Player</h1>
    <canvas id=canvas width=500 height=500></canvas>
</body>

</html>
